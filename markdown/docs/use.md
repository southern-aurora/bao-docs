# Use

Use 位于 `/src/use` 目录，它是一个没有任何"魔法"的目录。我们约定俗成，将一些通用的功能放在这里，并以 `use` 开头。

## 编写

我们约定俗成，一个 `use` 文件，以下面的方式来编写：

```ts
export type UseSayHelloOptions = {
  // ...
};

export function useSayHello(options: UseSayHelloOptions) {

  // ...

  return {
    sayHello() {
      console.log("hello world");
    },
  };
}
```

它导出且只导出一个方法，方法名以 `use` 开头，方法名的后缀是你的功能名。

方法的参数是一个对象，对象中包含了你的功能的配置项。

方法的返回值是一个对象，对象中包含了各种执行你的功能的方法。

## Use 是 Service 吗？

如果你有接触了其他的后端框架的经验，Service 的概念应该不陌生。有些人可能会认为 Use 就是 Bao 中的 Service，但是，我们认为 Use 和 Service 是截然不同的：

- Service 通常由 DI 容器来管理，是一个单例。而 Bao 没有 DI 容器，Use 是一个方法，根据参数来构造你所需要的对象。

- Use 比 Service 更纯粹，它不应该以业务命名（比如 `useUser`，提供增删改查用户的功能），而是应该以功能命名（比如 `useDatabase`，提供与数据库的通信和封装功能）。

- 业务逻辑应该写在 Api Action 中，而不是写在 Use 中。

- 我们约定俗成，Use 之间不进行互相调用。

## 为什么要这样做？Controller-Service 不好吗？

许多后端的开发者习惯将一切逻辑都放在 Service 中，Controller 几乎只是一个校验检查传入的数据、并调用 Service 的地方。他们严格遵循只在 Service 中才会编写查询数据库的代码。

在 Bao 中，我们不推荐这样做。我们认为，应该将所有的逻辑都写在 Api 的 Action 中。这可能会导致部分代码的冗余，例如，在获取文章详细信息的功能中，也有必要获取用户信息。这会导致我们在编写文章详细信息 Api 时，额外多编写一遍获取用户信息的代码。

但是，这样的冗余我认为是有必要的。这会为我们多人协作时带来更多的好处：代码简洁而直观，尤其是对于新加入的协作者而言，他们没有时间也不愿意去熟悉项目的旧逻辑，他们只想快速的开始编写新的业务。如果限制他们只能在 Service 中编写逻辑，那么他们就必须去了解旧的逻辑，而 Service 与 URL 并非是严格一一对应的，这会导致他们花费大量的时间和精力在熟悉旧的业务逻辑当中。这也是我认为 DDD 的弊端所在。

同时，如果一旦需求变动，比如获取文章详细信息中，不要获取用户的邮箱与手机号，而在修改用户资料的获取用户信息中，需要额外的获取用户的邮箱与手机号，在前期系统设计时没有考虑到这些需求，就会导致后期的代码变得越来越混乱。

因此，在 Bao 中，我们约定俗成，Use 将会是一个比 Service 更纯粹的东西，它只是一些通用的功能的封装，而不应该包含任何业务逻辑。

Use 之间不应该相互调用，如果一个需求你认为需要多个 Use 才能完成，那么你应该在 Api Action 中，通过调用多个 Use 的方式完成，而不是在 Use 中相互调用。